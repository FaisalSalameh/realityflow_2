<html>
  <head>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <!-- polyfill -->
    <script src="music/inc/shim/Base64.js" type="text/javascript"></script>
    <script src="music/inc/shim/Base64binary.js" type="text/javascript"></script>
    <script src="music/inc/shim/WebAudioAPI.js" type="text/javascript"></script>
    <!-- midi.js package -->
    <script src="music/js/midi/audioDetect.js" type="text/javascript"></script>
    <script src="music/js/midi/gm.js" type="text/javascript"></script>
    <script src="music/js/midi/loader.js" type="text/javascript"></script>
    <script src="music/js/midi/plugin.audiotag.js" type="text/javascript"></script>
    <script src="music/js/midi/plugin.webaudio.js" type="text/javascript"></script>
    <script src="music/js/midi/plugin.webmidi.js" type="text/javascript"></script>
    <!-- utils -->
    <script src="music/js/util/dom_request_xhr.js" type="text/javascript"></script>
    <script src="music/js/util/dom_request_script.js" type="text/javascript"></script>
    <script src="bower_components/WebMidi/src/webmidi.js"></script>
    <script>
    window.onload = function () {
        WebMidi.enable(function (err) {
            
            if (err) {
                //console.log("WebMidi could not be enabled.", err);
            } else {
                //console.log("WebMidi enabled!");
                //console.log(WebMidi.inputs);
                //console.log(WebMidi.outputs);
                var connected = false;
                var output = WebMidi.outputs[0];
                output.playNote("C3");
                var input = WebMidi.inputs[0];
                // Listen for a 'note on' message on all channels
                input.addListener('noteon', "all",
                                  function (e) {
                                      console.log("Received 'noteon' message (" + e.note.name + e.note.octave + ").", e);
                                      		MIDI.noteOn(0, e.note.number, e.rawVelocity);

                                  }
                                 );
                // Listen for a 'note on' message on all channels
                input.addListener('noteoff', "all",
                                  function (e) {
                                      console.log("Received 'noteoff' message (" + e.note.name + e.note.octave + ").",e);
                                      		MIDI.noteOff(0, e.note.number);
                                  }
                                 );
            }
            
        });
        
        MIDI.loadPlugin({
	    soundfontUrl: "music/soundfont/",
	    instrument: "acoustic_grand_piano",
	    onprogress: function(state, progress) {
		console.log(state, progress);
	    },
	    onsuccess: function() {
		var delay = 0; // play one note every quarter second
		var note = 50; // the MIDI note
		var velocity = 127; // how hard the note hits
		// play the note
		MIDI.setVolume(0, 127);
		MIDI.noteOn(0, note, velocity, delay);
		MIDI.noteOff(0, note, delay + 0.75);
	    }
	});
        }
  </script>
  </head>
  <body>
  </body>
  
</html>
