<script src="js/tests.js"></script>
<script src="flow-extensions/editor_common.js"></script>
<script src="modules/editor/editor.js"></script>
<script src="js/unity_interface.js"></script>
<script>
    function loadPanels() {
        var includes = $('.panel[data-include]');
        jQuery.each(includes, function () {
            var file = 'flow-extensions/' + $(this).data('include') + '.html';
            var id = $(this).attr('id');
            $(this).load(file, function () { loadExtensions(id) });
        });
    }
    function loadExtensions(id) {
        var includes = $('#' + id + ' .extension[data-include]');
        if (includes.length == 0)
            includes = $('#' + id);
        jQuery.each(includes, function () {
            var file = 'flow-extensions/' + $(this).data('include') + '.html';
            $(this).load(file);
        });
    }
    loadPanels();
    $.each($(".modal[data-include]"), function () {
        //console.log("[editor_container] Loading Modal!!");
        var id = $(this).attr('id');
        loadExtensions(id);
    })
    function loadUnity() {
        if (!loaderAdded) {
            window.addEventListener("unity_moduleLoaded", function () {
                if (!loaderAdded) {
                    //console.log("[editor_container] Adding loader");
                    $('body').append($(`<script src="Development/UnityLoader.js"><\/script>`));
                    loaderAdded = true;
                    moduleLoaded=true;
                }
            });
            $('body').append($(`<script type="text/javascript">
                //console.log("[editor_container] Loading module...");
                var Module = {
                TOTAL_MEMORY: 268435456,
                errorhandler: null,			// arguments: err, url, line. This function must return "true" if the error is handled, otherwise "false"
                compatibilitycheck: null,
                backgroundColor: "#222C36",
                splashStyle: "Light",
                dataUrl: "Development\/static.data",
                codeUrl: "Development\/static.js",
                asmUrl: "Development\/static.asm.js",
                memUrl: "Development\/static.mem",};
                
                //console.log("[editor_container]",Module);
                window.dispatchEvent(evt_moduleLoaded);
                moduleLoaded=true;
                <\/script>`));
                var newheight = $(window).innerHeight()-$("#navbar").innerHeight()-100;
                $("#editor > canvas").height(newheight);
                var newwidth = $(window).innerWidth()-$("#editorLeftSideBar").innerWidth()-$("#editorRightSideBar").innerWidth();
                $("#editor").width(newwidth);

        }
    }
    window.addEventListener("launch_editor",loadUnity);
    $(window).resize(function(evt) {
        var newheight = $(window).innerHeight()-$("#navbar").innerHeight()-100;
        $("#editor > canvas").height(newheight);
        var newwidth = $(window).innerWidth()-$("#editor_left").innerWidth()-$("#editor_right").innerWidth();
        $("#editor").width(newwidth);
    })
    //console.log("Loaded editor");
    window.dispatchEvent(evt_editorReady);
    editorLoaded=true;

    var moduleLoaded = false;
</script>
<div class="no-float panel" data-include="editor_left" id="editorLeftSideBar">
</div>
<div class="no-float" id="editor">
    <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
    <div class="panel panel-default" data-include="tool_palette" id="editorToolPalette"></div>
</div>
<div class="no-float panel" data-include="editor_right" id="editorRightSideBar">
</div>
