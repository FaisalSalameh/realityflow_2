<script>
    var clients = [];
    function notify(msg) {
        $.notify({ message: msg },
            {
                position: "absolute",
                offset: {
                    x: 0,
                    y: 50
                },
                spacing: 2,
                type: "info",
                delay: 3000,
                newest_on_top: true,
                mouse_over: "pause",
                placement: { align: "center" },
                template: '<div data-notify="container" class="col-xs-11 col-sm-3 alert alert-{0}" role="alert">' +
                '<button type="button" aria-hidden="true" class="close" data-notify="dismiss">Ã—</button>' +
                '<img data-notify="icon" class="img-circle pull-left">' +
                '<span data-notify="title">{1}</span>' +
                '<span data-notify="message">{2}</span>' +
                '</div>'
            }
        );
    }


    function populateClients(clients) {
        $("#clients").empty;
        $.each(clients, function (index, value) {
            if (document.getElementById(value._id) == null) {
                var html = $("<div class='list-group-item " + clientStateToClass(value.state) + "'" + 
                " id='" + value._id + "'>" + getType(value.type) + " <span class='badge badge-default badge-pill'>" + 
                value._id.substr(-5) + "</span></div>");
                $("#clients").append(html);
            }
        })
    }

    function deleteClient(client) {

    }

    function newClient(client) {
        //console.log("[client_inspector] New client", client);
        //console.log("Adding "+clientStateToClass(client.state));
        if (document.getElementById(client._id) == null) {
            var newClientElem = $("<div class='list-group-item " +
                "' id='" + client._id + "'>" +
                "<span class='clientType'>" + getType(client.type) +
                "</span><span class='badge badge-default badge-pill'>" +
                client._id.substr(-5) + "</span></div>");
                newClientElem.addClass(clientStateToClass(client.state))
            $("#clients").append(newClientElem);
        } else {
            $("#" + client._id).addClass(clientStateToClass(client.state));
        }
        notify("Client Connected: " + getType(client.type) + " " + client._id.substr(-5))
    }

    function clientDisconnect(client) {
        $("#" + client._id).removeClass(clientStateToClass(commands.STATE_CONNECTED));
    }

    if (!loggedIn) {
        window.addEventListener('ws_loggedIn', function () {
            //console.log("[client_inspector] registering listeners");
            remoteFunctionCall(commands.client.GET_CLIENTS, null, populateClients);
            registerListener(commands.client.CLIENT_DISCONNECT, clientDisconnect);
            registerListener(commands.client.NEW_CLIENT, newClient);
        });
    } else {
        //console.log("[client_inspector] registering listeners");
        remoteFunctionCall(commands.client.GET_CLIENTS, null, populateClients);
        removeAllListeners(commands.client.NEW_CLIENT);
        removeAllListeners(commands.client.CLIENT_DISCONNECT);
        registerListener(commands.client.NEW_CLIENT, newClient);
        registerListener(commands.client.CLIENT_DISCONNECT, clientDisconnect);
    }

</script>
<div class="panel panel-default" id="clientContainer">
    <div class="panel panel-header">Clients</div>
    <div clas="panel panel-body">
        <div class='list-group clients' id="clients"></div>
        <div>Guests</div>
        <div class='list-group clients' id="guest_clients"></div>
    </div>
</div>